/* style.css (REVISED & REDESIGNED - V2) */

/* 1. FONT IMPORT & DESIGN SYSTEM: "Oceanic Serenity" */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&family=Inter:wght@400;500;600&display=swap');

:root {
    --font-heading: 'Poppins', sans-serif;
    --font-body: 'Inter', sans-serif;
    
    /* Oceanic Serenity Palette */
    --color-primary: #1F4287;
    --color-primary-dark: #071E3D;
    --color-secondary: #278EA5;
    --color-text-primary: #0A2463;
    --color-text-secondary: #506266;
    --color-surface: #FFFFFF;
    --color-background: #F8F7F4;
    --color-border: #DDE2E7;
    
    --color-correct: #16A085;
    --color-incorrect: #E74C3C;
    --color-warning: #F39C12;
    --color-review: #8E44AD;
    
    --shadow-sm: 0 2px 4px 0 rgb(0 0 0 / 0.04);
    --shadow-md: 0 4px 8px -2px rgb(0 0 0 / 0.08), 0 2px 4px -2px rgb(0 0 0 / 0.05);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05);
}

/* 2. GLOBAL STYLES & RESETS */
* {
    box-sizing: border-box;
}

html, body {
    margin: 0;
    padding: 0;
    font-family: var(--font-body);
    background-color: var(--color-background);
    color: var(--color-text-secondary);
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
}

.container {
    width: 100%;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.screen {
    width: 100%;
    max-width: 1200px;
    background-color: var(--color-surface);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    display: none;
}
.screen.active {
    display: block;
}

h1, h2, h3, h4, strong {
    font-family: var(--font-heading);
    color: var(--color-text-primary);
    font-weight: 600;
}

/* 3. AUTH & SELECTION SCREENS (No major changes) */
#login-screen, #welcome-screen, #selection-screen, #instruction-screen {
    padding: clamp(2rem, 8vw, 4rem);
    text-align: center;
}
#login-title, #welcome-title { font-size: clamp(2.2rem, 6vw, 3rem); font-weight: 700; }
#login-subtitle, #welcome-subtitle, #selection-description { font-size: clamp(1rem, 3vw, 1.15rem); max-width: 550px; margin: 1rem auto 2.5rem auto; line-height: 1.7; }
.form-group { max-width: 400px; margin: 2rem auto; text-align: left; }
.form-group label { font-weight: 600; margin-bottom: 0.75rem; display: block; color: var(--color-text-primary); }
#participant-name, #access-code { width: 100%; padding: 14px; font-size: 1rem; border: 1px solid var(--color-border); border-radius: 10px; transition: all 0.2s; background-color: var(--color-background); }
#participant-name:focus, #access-code:focus { border-color: var(--color-primary); box-shadow: 0 0 0 4px color-mix(in srgb, var(--color-primary) 20%, transparent); outline: none; background-color: var(--color-surface); }
.error-message { color: var(--color-incorrect); font-weight: 500; font-size: 0.9em; margin-top: 8px; display: none; }
.start-btn { background-color: var(--color-primary); color: white; border: none; padding: 14px 28px; font-size: 1rem; font-weight: 600; font-family: var(--font-heading); border-radius: 10px; cursor: pointer; transition: all 0.25s ease; display: inline-flex; align-items: center; justify-content: center; gap: 10px; box-shadow: var(--shadow-md); }
.start-btn:hover:not(:disabled) { background-color: var(--color-primary-dark); transform: translateY(-3px); box-shadow: var(--shadow-lg); }
.selection-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; max-width: 900px; margin: 2rem auto 0; }
.selection-btn { background-color: var(--color-surface); border: 2px solid var(--color-border); border-radius: 12px; padding: 20px; text-align: left; cursor: pointer; transition: all 0.2s ease; }
.selection-btn:hover:not(.locked) { transform: translateY(-5px); border-color: var(--color-secondary); box-shadow: var(--shadow-md); }
.selection-btn.locked { background-color: #F0F0F0; color: #A0A0A0; cursor: not-allowed; opacity: 0.7; }

/* 5. TEST INTERFACE (MOBILE-FIRST REDESIGN) */
#test-screen.active, #review-screen.active {
    display: flex;
    flex-direction: column;
    height: 100vh;
    max-height: 100vh;
    background-color: var(--color-surface);
}

.test-header-mobile {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0.75rem 1rem; border-bottom: 1px solid var(--color-border);
    flex-shrink: 0; background-color: var(--color-surface); position: sticky; top: 0; z-index: 100;
}
.test-header-mobile #question-number-category-mobile { font-weight: 600; color: var(--color-text-primary); }
.test-header-mobile #timer-mobile { font-weight: 700; font-size: 1.1rem; color: var(--color-primary); }
#menu-toggle-btn, #review-menu-toggle-btn { background: none; border: none; font-size: 1.5rem; color: var(--color-text-secondary); cursor: pointer; }

/* -- NEW -- Sidebar Overlay */
.sidebar-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 998;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0s 0.3s;
}
.sidebar-overlay.open {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease;
}

/* -- FIXED -- Sidebar/Drawer */
.sidebar {
    position: fixed; top: 0; left: 0; width: 300px; height: 100%;
    background-color: var(--color-background);
    border-right: 1px solid var(--color-border);
    display: flex; flex-direction: column;
    padding: 1.5rem;
    z-index: 999;
    transform: translateX(-100%); /* Start off-screen */
    transition: transform 0.3s ease-in-out;
}
.sidebar.open {
    transform: translateX(0); /* Slide in */
}
.sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-shrink: 0; }
.sidebar-header h3 { margin: 0; font-size: 1.2rem; }
#close-sidebar-btn, #review-close-sidebar-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }

#timer-desktop { font-size: 1.5rem; font-weight: 700; color: var(--color-primary); text-align: center; margin-bottom: 1rem; }
#progress-bar-container { width: 100%; height: 8px; background-color: var(--color-border); border-radius: 4px; overflow: hidden; margin-bottom: 1.5rem; }
#progress-bar { height: 100%; background-color: var(--color-secondary); border-radius: 4px; transition: width 0.5s; }

/* -- FIXED -- Question Grid - No horizontal scroll */
.question-grid-container {
    overflow-y: auto; /* Allow grid to scroll if it has too many items */
}
#question-grid, #review-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); /* Adjusted for padding */
    gap: 0.5rem;
}
.q-btn { width: 100%; aspect-ratio: 1 / 1; border: 2px solid var(--color-border); background-color: var(--color-surface); border-radius: 8px; cursor: pointer; transition: all 0.2s; font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; }
.q-btn.current { border-color: var(--color-primary); transform: scale(1.1); box-shadow: var(--shadow-md); font-weight: 700; background-color: var(--color-primary); color: white;}
.q-btn.answered { background-color: color-mix(in srgb, var(--color-secondary) 20%, transparent); border-color: var(--color-secondary); }
.q-btn.review-correct { background-color: var(--color-correct); color: white; border-color: var(--color-correct); }
.q-btn.review-incorrect { background-color: var(--color-incorrect); color: white; border-color: var(--color-incorrect); }

.main-content {
    flex-grow: 1; padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column;
}
#question-text { font-size: 1.1rem; line-height: 1.7; margin: 0.5rem 0 2rem 0; color: var(--color-text-primary); white-space: pre-wrap; }
.options-container { display: flex; flex-direction: column; gap: 1rem; }
.option { display: flex; align-items: flex-start; border: 2px solid var(--color-border); padding: 1rem; border-radius: 12px; cursor: pointer; transition: all 0.2s; }
.option-label { width: 24px; height: 24px; border: 2px solid var(--color-border); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 1rem; font-weight: 700; flex-shrink: 0; margin-top: 1px; transition: all 0.2s; }
.option:hover { border-color: var(--color-secondary); }
.option input[type="radio"] { display: none; }
.option:has(input:checked) { border-color: var(--color-primary); background-color: color-mix(in srgb, var(--color-primary) 10%, transparent); }
.option:has(input:checked) .option-label { background-color: var(--color-primary); border-color: var(--color-primary); color: white; }

/* -- FIXED -- Test Footer with flexible, stacking buttons */
.test-footer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 0.75rem;
    padding: 1.5rem 0 0; border-top: 1px solid var(--color-border);
    margin-top: auto; /* Pushes footer to bottom */
    background-color: var(--color-surface);
}
.footer-btn { padding: 12px; font-weight: 600; font-family: var(--font-heading); width: 100%; }
#prev-btn { grid-column: 1 / 2; }
#next-btn { grid-column: -2 / -1; }
#finish-btn {
    background-color: var(--color-correct); color: white; border: none;
    /* Spans across all columns if it's the only one left */
    grid-column: 1 / -1; 
}
/* On wider screens within mobile, put finish in middle */
@media (min-width: 400px) {
    .test-footer {
        grid-template-columns: 1fr auto 1fr;
    }
    #prev-btn { justify-self: start; width: auto; }
    #next-btn { justify-self: end; width: auto; }
    #finish-btn { grid-column: 2 / 3; width: auto; }
}


/* -- NEW -- Custom Modal for Confirmation */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex; justify-content: center; align-items: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0s 0.3s;
}
.modal-overlay.active {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease;
}
.modal-content {
    background: var(--color-surface);
    padding: 2rem;
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    width: 90%;
    max-width: 400px;
    text-align: center;
    transform: scale(0.9);
    transition: transform 0.3s ease;
}
.modal-overlay.active .modal-content {
    transform: scale(1);
}
.modal-content h3 { margin-top: 0; }
.modal-content p { margin: 1rem 0 2rem 0; line-height: 1.6; }
.modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
}
.modal-actions .btn-secondary {
    background-color: transparent;
    border: 2px solid var(--color-border);
    color: var(--color-text-secondary);
}


/* All other sections (Results, Review, Desktop) remain largely the same, but benefit from the fixes above */
/* 6. RESULTS SCREEN (REDESIGNED) */
#results-screen { padding: 1.5rem; background-color: var(--color-background); }
#report-container { padding: clamp(1.5rem, 5vw, 3rem); background-color: var(--color-surface); border-radius: 16px; border: 1px solid var(--color-border); }
.report-header { text-align: center; margin-bottom: 3rem; }
.report-header .logo { font-size: 4rem; color: var(--color-primary); margin-bottom: 1rem; }
.report-header h2 { font-size: 1.75rem; margin: 0; }
.report-header p { margin: 0.5rem 0 0; font-size: 1.1rem; }
.report-card { background-color: var(--color-surface); padding: 1.5rem; border: 1px solid var(--color-border); border-radius: 12px; margin-bottom: 1.5rem; }
.report-card h3 { margin: 0 0 1.5rem 0; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border); font-size: 1.2rem; display: flex; align-items: center; gap: 0.75rem; }
#summary-card .score-display { position: relative; width: 180px; height: 180px; margin: 1rem auto 2rem; border-radius: 50%; background: conic-gradient(var(--color-primary) calc(var(--score, 0) * 3.6deg), var(--color-border) 0deg); display: flex; flex-direction: column; justify-content: center; align-items: center; }
#summary-card .score-display::before { content: ''; position: absolute; width: 150px; height: 150px; background: var(--color-surface); border-radius: 50%; }
#final-score { z-index: 1; font-size: 4rem; line-height: 1; font-weight: 700; color: var(--color-text-primary); }
#score-predicate { z-index: 1; font-size: 1.1rem; color: var(--color-primary); font-weight: 600; margin-top: 0.5rem; }
#summary-card .details-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
.detail-item { text-align: center; background-color: var(--color-background); padding: 1rem; border-radius: 8px; }
.detail-item .value { font-size: 1.75rem; font-weight: 700; color: var(--color-text-primary); display: block; }
.detail-item .label { font-size: 0.85rem; font-weight: 500; }
.result-actions { display: flex; flex-direction: column; gap: 1rem; margin-top: 2rem; }

/* 7. REVIEW SCREEN */
#review-screen .test-header-mobile #timer-mobile { display: none; }
#review-screen .sidebar h3 { color: var(--color-review); }
#review-status-banner { padding: 1rem 1.25rem; border-radius: 12px; margin-bottom: 2rem; font-weight: 600; color: white; font-size: 1.1rem; display: flex; align-items: center; gap: 0.75rem; }
#review-status-banner.correct { background-color: var(--color-correct); }
#review-status-banner.incorrect { background-color: var(--color-incorrect); }
#review-explanation-box { margin-top: 2.5rem; padding: 1.5rem; background-color: var(--color-background); border-radius: 12px; border-left: 5px solid var(--color-secondary); }

/* 8. DESKTOP RESPONSIVENESS */
@media (min-width: 768px) {
    .container { padding: 1.5rem; }
    #test-screen.active, #review-screen.active { flex-direction: row; }
    .test-header-mobile { display: none; }
    .sidebar { position: static; transform: translateX(0); width: 320px; box-shadow: none; }
    .sidebar-overlay { display: none; } /* No overlay on desktop */
    .main-content { padding: 2.5rem 3.5rem; }
    .result-actions { flex-direction: row; justify-content: center; gap: 1.5rem; }
    .test-footer { grid-template-columns: 1fr auto 1fr; }
    #prev-btn { justify-self: start; width: auto; }
    #next-btn { justify-self: end; width: auto; }
    #finish-btn { grid-column: 2 / 3; width: auto; }
}
